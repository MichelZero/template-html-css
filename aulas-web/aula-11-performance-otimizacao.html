<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aula 11: Performance e Otimiza√ß√£o - Curso HTML Fundamentals</title>
    <meta name="description" content="D√©cima primeira aula do curso de HTML: domine t√©cnicas de performance, otimiza√ß√£o de carregamento e Core Web Vitals.">
    <link rel="stylesheet" href="assets/style-aulas.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ö°</text></svg>">
</head>
<body>
    <div class="aula-container">
        <!-- Navega√ß√£o -->
        <nav class="aula-nav">
            <a href="aula-10-seo-metatags.html" class="nav-btn">
                ‚Üê üìà Aula Anterior
            </a>
            <a href="index.html" class="nav-btn">
                üìö Curso
            </a>
            <a href="aula-12-projeto-final.html" class="nav-btn">
                üéØ Projeto Final ‚Üí
            </a>
        </nav>

        <!-- Header da Aula -->
        <header class="aula-header">
            <div class="aula-numero">AULA 11</div>
            <h1 class="aula-titulo">‚ö° Performance e Otimiza√ß√£o</h1>
            <p class="aula-descricao">
                Aprenda t√©cnicas avan√ßadas de otimiza√ß√£o para criar sites r√°pidos, 
                eficientes e com excelente experi√™ncia do usu√°rio.
            </p>
            <div class="aula-meta">
                <div class="meta-item">
                    <span>‚è±Ô∏è</span> <span>65 minutos</span>
                </div>
                <div class="meta-item">
                    <span>üéØ</span> <span>Avan√ßado</span>
                </div>
                <div class="meta-item">
                    <span>üìù</span> <span>4 Exerc√≠cios</span>
                </div>
            </div>
        </header>

        <!-- Objetivos da Aula -->
        <div class="objetivos">
            <h3>üéØ Objetivos de Aprendizagem</h3>
            <ul>
                <li>Compreender Core Web Vitals e m√©tricas de performance</li>
                <li>Otimizar imagens e recursos para web</li>
                <li>Implementar carregamento ass√≠ncrono e lazy loading</li>
                <li>Usar t√©cnicas de preloading e prefetching</li>
                <li>Monitorar e medir performance continuamente</li>
            </ul>
        </div>

        <!-- Se√ß√£o 1: Core Web Vitals -->
        <section class="secao">
            <h2>üìä 1. Core Web Vitals</h2>
            
            <div class="destaque info">
                <h4>üéØ O que s√£o Core Web Vitals?</h4>
                <p>
                    Core Web Vitals s√£o m√©tricas essenciais do Google que medem a 
                    <strong>experi√™ncia do usu√°rio</strong> em termos de carregamento, 
                    interatividade e estabilidade visual.
                </p>
            </div>

            <h3>üöÄ LCP - Largest Contentful Paint</h3>
            <div class="codigo" data-lang="HTML">
<pre><code>&lt;!-- Otimizando LCP - elemento principal deve carregar r√°pido --&gt;

&lt;!-- ‚ùå RUIM: Imagem grande sem otimiza√ß√£o --&gt;
&lt;img src="hero-image.jpg" alt="Hero image"&gt;

&lt;!-- ‚úÖ BOM: Imagem otimizada com preload --&gt;
&lt;head&gt;
    &lt;link rel="preload" as="image" href="hero-optimized.webp"&gt;
&lt;/head&gt;

&lt;picture&gt;
    &lt;source srcset="hero-optimized.webp" type="image/webp"&gt;
    &lt;source srcset="hero-optimized.jpg" type="image/jpeg"&gt;
    &lt;img src="hero-optimized.jpg" 
         alt="Imagem principal do site"
         width="1200" 
         height="600"
         loading="eager"&gt;
&lt;/picture&gt;

&lt;!-- Preload para fontes cr√≠ticas --&gt;
&lt;link rel="preload" 
      href="fonts/primary-font.woff2" 
      as="font" 
      type="font/woff2" 
      crossorigin&gt;

&lt;!-- Evitar mudan√ßas de layout durante carregamento --&gt;
&lt;div class="hero-container" style="aspect-ratio: 2/1;"&gt;
    &lt;img src="hero.jpg" alt="Hero" loading="eager"&gt;
&lt;/div&gt;</code></pre>
            </div>

            <h3>‚ö° FID - First Input Delay</h3>
            <div class="codigo" data-lang="HTML">
<pre><code>&lt;!-- Otimizando FID - reduzir bloqueio de JavaScript --&gt;

&lt;!-- ‚ùå RUIM: Scripts bloqueantes no head --&gt;
&lt;head&gt;
    &lt;script src="heavy-library.js"&gt;&lt;/script&gt;
    &lt;script src="analytics.js"&gt;&lt;/script&gt;
&lt;/head&gt;

&lt;!-- ‚úÖ BOM: Scripts ass√≠ncronos e n√£o-cr√≠ticos no final --&gt;
&lt;head&gt;
    &lt;!-- Apenas CSS cr√≠tico no head --&gt;
    &lt;style&gt;
        /* CSS cr√≠tico inline para primeira renderiza√ß√£o */
        .hero { 
            background: #007bff; 
            height: 60vh; 
        }
        .nav { 
            background: #fff; 
            position: fixed; 
            top: 0; 
        }
    &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;!-- Conte√∫do da p√°gina --&gt;
    
    &lt;!-- Scripts no final do body --&gt;
    &lt;script async src="analytics.js"&gt;&lt;/script&gt;
    &lt;script defer src="heavy-library.js"&gt;&lt;/script&gt;
    
    &lt;!-- CSS n√£o-cr√≠tico carregado de forma ass√≠ncrona --&gt;
    &lt;script&gt;
        // Carregar CSS n√£o-cr√≠tico ap√≥s load
        window.addEventListener('load', function() {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'non-critical.css';
            document.head.appendChild(link);
        });
    &lt;/script&gt;
&lt;/body&gt;</code></pre>
            </div>

            <h3>üìê CLS - Cumulative Layout Shift</h3>
            <div class="codigo" data-lang="HTML">
<pre><code>&lt;!-- Prevenindo CLS - reservar espa√ßo para elementos --&gt;

&lt;!-- ‚ùå RUIM: Sem dimens√µes especificadas --&gt;
&lt;img src="product.jpg" alt="Produto"&gt;
&lt;div id="ad-banner"&gt;&lt;/div&gt;

&lt;!-- ‚úÖ BOM: Dimens√µes especificadas --&gt;
&lt;img src="product.jpg" 
     alt="Produto" 
     width="400" 
     height="300"
     style="aspect-ratio: 4/3;"&gt;

&lt;!-- Placeholder para conte√∫do din√¢mico --&gt;
&lt;div id="ad-banner" 
     style="width: 728px; height: 90px; background: #f0f0f0;"&gt;
    &lt;!-- Conte√∫do do banner ser√° inserido aqui --&gt;
&lt;/div&gt;

&lt;!-- Skeleton loading para prevenir shifts --&gt;
&lt;div class="comment-skeleton" aria-hidden="true"&gt;
    &lt;div class="skeleton-avatar"&gt;&lt;/div&gt;
    &lt;div class="skeleton-content"&gt;
        &lt;div class="skeleton-line"&gt;&lt;/div&gt;
        &lt;div class="skeleton-line short"&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;!-- Fontes web com fallbacks para evitar FOIT/FOUT --&gt;
&lt;style&gt;
    body {
        font-family: 'CustomFont', Arial, sans-serif;
        font-display: swap; /* Troca imediata quando fonte carrega */
    }
    
    .skeleton-avatar {
        width: 40px;
        height: 40px;
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
        border-radius: 50%;
    }
    
    @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }
&lt;/style&gt;</code></pre>
            </div>

            <div class="destaque warning">
                <h4>‚ö†Ô∏è Metas dos Core Web Vitals</h4>
                <ul>
                    <li><strong>LCP:</strong> ‚â§ 2.5 segundos</li>
                    <li><strong>FID:</strong> ‚â§ 100 milissegundos</li>
                    <li><strong>CLS:</strong> ‚â§ 0.1</li>
                    <li><strong>Meta:</strong> 75% das visitas devem atingir esses valores</li>
                </ul>
            </div>
        </section>

        <!-- Exerc√≠cio 1 -->
        <div class="exercicio">
            <h4>üèãÔ∏è‚Äç‚ôÇÔ∏è Exerc√≠cio 1: Auditoria de Core Web Vitals</h4>
            <p>
                Fa√ßa uma auditoria completa de performance:
            </p>
            <ul>
                <li>Use Google PageSpeed Insights</li>
                <li>Analise Lighthouse no DevTools</li>
                <li>Identifique problemas de LCP, FID e CLS</li>
                <li>Implemente corre√ß√µes para cada m√©trica</li>
                <li>Re-teste e documente melhorias</li>
            </ul>
        </div>

        <!-- Se√ß√£o 2: Otimiza√ß√£o de Imagens -->
        <section class="secao">
            <h2>üñºÔ∏è 2. Otimiza√ß√£o de Imagens</h2>
            
            <h3>üì± Imagens Responsivas</h3>
            <div class="codigo" data-lang="HTML">
<pre><code>&lt;!-- Picture element para diferentes contextos --&gt;
&lt;picture&gt;
    &lt;!-- Imagem para desktop --&gt;
    &lt;source media="(min-width: 1024px)" 
            srcset="hero-desktop.webp 1200w,
                    hero-desktop-2x.webp 2400w"
            sizes="100vw"
            type="image/webp"&gt;
    
    &lt;!-- Imagem para tablet --&gt;
    &lt;source media="(min-width: 768px)" 
            srcset="hero-tablet.webp 768w,
                    hero-tablet-2x.webp 1536w"
            sizes="100vw"
            type="image/webp"&gt;
    
    &lt;!-- Imagem para mobile --&gt;
    &lt;source media="(max-width: 767px)" 
            srcset="hero-mobile.webp 400w,
                    hero-mobile-2x.webp 800w"
            sizes="100vw"
            type="image/webp"&gt;
    
    &lt;!-- Fallback JPEG --&gt;
    &lt;img src="hero-desktop.jpg" 
         alt="Imagem principal do site"
         width="1200" 
         height="600"
         loading="eager"&gt;
&lt;/picture&gt;

&lt;!-- Srcset simples para diferentes densidades --&gt;
&lt;img src="product.jpg"
     srcset="product-1x.jpg 1x,
             product-2x.jpg 2x,
             product-3x.jpg 3x"
     alt="Produto em destaque"
     width="300"
     height="200"&gt;</code></pre>
            </div>

            <h3>‚ö° Lazy Loading</h3>
            <div class="codigo" data-lang="HTML">
<pre><code>&lt;!-- Lazy loading nativo --&gt;
&lt;img src="image1.jpg" 
     alt="Imagem da galeria"
     loading="lazy"
     width="400" 
     height="300"&gt;

&lt;!-- Primeira imagem sempre eager --&gt;
&lt;img src="hero.jpg" 
     alt="Imagem principal"
     loading="eager"
     width="1200" 
     height="600"&gt;

&lt;!-- Lazy loading avan√ßado com Intersection Observer --&gt;
&lt;img data-src="high-res-image.jpg" 
     src="placeholder-blur.jpg"
     alt="Imagem de alta resolu√ß√£o"
     class="lazy-load"
     width="800" 
     height="400"&gt;

&lt;script&gt;
// Implementa√ß√£o de lazy loading com blur-up
class LazyImageLoader {
    constructor() {
        this.imageObserver = null;
        this.init();
    }
    
    init() {
        if ('IntersectionObserver' in window) {
            this.imageObserver = new IntersectionObserver((entries, observer) =&gt; {
                entries.forEach(entry =&gt; {
                    if (entry.isIntersecting) {
                        this.loadImage(entry.target);
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                rootMargin: '50px 0px' // Carregar 50px antes de aparecer
            });
            
            this.observeImages();
        } else {
            // Fallback para navegadores antigos
            this.loadAllImages();
        }
    }
    
    observeImages() {
        const lazyImages = document.querySelectorAll('.lazy-load');
        lazyImages.forEach(img =&gt; this.imageObserver.observe(img));
    }
    
    loadImage(img) {
        const src = img.dataset.src;
        if (!src) return;
        
        // Criar nova imagem para preload
        const imageLoader = new Image();
        imageLoader.onload = () =&gt; {
            img.src = src;
            img.classList.add('loaded');
        };
        imageLoader.src = src;
    }
    
    loadAllImages() {
        const lazyImages = document.querySelectorAll('.lazy-load');
        lazyImages.forEach(img =&gt; this.loadImage(img));
    }
}

// Inicializar lazy loading
new LazyImageLoader();
&lt;/script&gt;

&lt;style&gt;
.lazy-load {
    filter: blur(5px);
    transition: filter 0.3s ease;
}

.lazy-load.loaded {
    filter: blur(0);
}
&lt;/style&gt;</code></pre>
            </div>

            <h3>üé® Formatos Modernos</h3>
            <div class="codigo" data-lang="HTML">
<pre><code>&lt;!-- Usando WebP com fallback --&gt;
&lt;picture&gt;
    &lt;source srcset="image.avif" type="image/avif"&gt;
    &lt;source srcset="image.webp" type="image/webp"&gt;
    &lt;img src="image.jpg" alt="Descri√ß√£o da imagem"&gt;
&lt;/picture&gt;

&lt;!-- SVG otimizado para √≠cones --&gt;
&lt;svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"&gt;
    &lt;path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/&gt;
&lt;/svg&gt;

&lt;!-- CSS Sprites para √≠cones pequenos --&gt;
&lt;div class="icon-star"&gt;&lt;/div&gt;

&lt;style&gt;
.icon-star {
    width: 24px;
    height: 24px;
    background: url('icons-sprite.webp') -48px -24px;
    background-size: 200px 100px;
}

/* CSS para imagens de fundo otimizadas */
.hero-background {
    background-image: 
        image-set(
            url('hero.webp') 1x,
            url('hero-2x.webp') 2x
        );
    background-size: cover;
    background-position: center;
}

/* Suporte a WebP via CSS */
.webp .hero-background {
    background-image: url('hero.webp');
}

.no-webp .hero-background {
    background-image: url('hero.jpg');
}
&lt;/style&gt;</code></pre>
            </div>
        </section>

        <!-- Exerc√≠cio 2 -->
        <div class="exercicio">
            <h4>üèãÔ∏è‚Äç‚ôÇÔ∏è Exerc√≠cio 2: Galeria de Imagens Otimizada</h4>
            <p>
                Crie uma galeria de imagens com m√°xima performance:
            </p>
            <ul>
                <li>Imagens responsivas com srcset</li>
                <li>Lazy loading com blur-up effect</li>
                <li>Formatos WebP/AVIF com fallbacks</li>
                <li>Placeholder skeleton loading</li>
                <li>Medi√ß√£o de impacto na performance</li>
            </ul>
        </div>

        <!-- Se√ß√£o 3: Carregamento Inteligente -->
        <section class="secao">
            <h2>üß† 3. Carregamento Inteligente</h2>
            
            <h3>üöÄ Resource Hints</h3>
            <div class="codigo" data-lang="HTML">
<pre><code>&lt;head&gt;
    &lt;!-- DNS prefetch para dom√≠nios externos --&gt;
    &lt;link rel="dns-prefetch" href="//fonts.googleapis.com"&gt;
    &lt;link rel="dns-prefetch" href="//www.google-analytics.com"&gt;
    &lt;link rel="dns-prefetch" href="//cdnjs.cloudflare.com"&gt;
    
    &lt;!-- Preconnect para recursos cr√≠ticos --&gt;
    &lt;link rel="preconnect" href="https://fonts.gstatic.com" crossorigin&gt;
    
    &lt;!-- Preload para recursos cr√≠ticos --&gt;
    &lt;link rel="preload" href="critical.css" as="style"&gt;
    &lt;link rel="preload" href="hero.webp" as="image"&gt;
    &lt;link rel="preload" href="main-font.woff2" as="font" type="font/woff2" crossorigin&gt;
    
    &lt;!-- Prefetch para recursos que ser√£o usados depois --&gt;
    &lt;link rel="prefetch" href="next-page.html"&gt;
    &lt;link rel="prefetch" href="secondary.css"&gt;
    
    &lt;!-- Modulepreload para ES modules --&gt;
    &lt;link rel="modulepreload" href="app.js"&gt;
&lt;/head&gt;</code></pre>
            </div>

            <h3>üì¶ Code Splitting</h3>
            <div class="codigo" data-lang="HTML">
<pre><code>&lt;!-- Carregamento modular de JavaScript --&gt;
&lt;script type="module"&gt;
    // Carregamento din√¢mico de m√≥dulos
    async function loadFeature(featureName) {
        try {
            const module = await import(`./features/${featureName}.js`);
            return module.default;
        } catch (error) {
            console.error(`Erro ao carregar ${featureName}:`, error);
        }
    }
    
    // Carregar funcionalidades sob demanda
    document.addEventListener('DOMContentLoaded', async () =&gt; {
        // Carregar funcionalidade cr√≠tica imediatamente
        const core = await loadFeature('core');
        core.init();
        
        // Carregar outras funcionalidades quando necess√°rio
        const lazyFeatures = ['gallery', 'comments', 'sharing'];
        
        const observer = new IntersectionObserver((entries) =&gt; {
            entries.forEach(async (entry) =&gt; {
                if (entry.isIntersecting) {
                    const feature = entry.target.dataset.feature;
                    if (lazyFeatures.includes(feature)) {
                        const module = await loadFeature(feature);
                        module.init(entry.target);
                        observer.unobserve(entry.target);
                    }
                }
            });
        });
        
        document.querySelectorAll('[data-feature]').forEach(el =&gt; {
            observer.observe(el);
        });
    });
&lt;/script&gt;

&lt;!-- Elementos que ativam carregamento de funcionalidades --&gt;
&lt;div class="gallery" data-feature="gallery"&gt;
    &lt;!-- Galeria ser√° inicializada quando vis√≠vel --&gt;
&lt;/div&gt;

&lt;div class="comments-section" data-feature="comments"&gt;
    &lt;!-- Sistema de coment√°rios carregado sob demanda --&gt;
&lt;/div&gt;</code></pre>
            </div>

            <h3>‚ö° Critical CSS</h3>
            <div class="codigo" data-lang="HTML">
<pre><code>&lt;head&gt;
    &lt;!-- CSS cr√≠tico inline --&gt;
    &lt;style&gt;
        /* CSS para above-the-fold content */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: #333;
        }
        
        .header {
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }
        
        .hero {
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
        }
        
        .hero h1 {
            font-size: clamp(2rem, 5vw, 4rem);
            margin-bottom: 1rem;
        }
        
        /* CSS cr√≠tico para layout */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
    &lt;/style&gt;
    
    &lt;!-- Carregar CSS completo de forma ass√≠ncrona --&gt;
    &lt;script&gt;
        // Fun√ß√£o para carregar CSS de forma ass√≠ncrona
        function loadCSS(href, media = 'all') {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = href;
            link.media = 'print'; // Carregar como print primeiro
            link.onload = () =&gt; link.media = media; // Mudar para all quando carregado
            document.head.appendChild(link);
        }
        
        // Carregar CSS n√£o-cr√≠tico ap√≥s DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () =&gt; {
            loadCSS('styles/complete.css');
            loadCSS('styles/components.css');
        });
        
        // Fallback caso JavaScript esteja desabilitado
    &lt;/script&gt;
    &lt;noscript&gt;
        &lt;link rel="stylesheet" href="styles/complete.css"&gt;
    &lt;/noscript&gt;
&lt;/head&gt;</code></pre>
            </div>

            <h3>üîÑ Service Workers</h3>
            <div class="codigo" data-lang="HTML">
<pre><code>&lt;!-- Registrar Service Worker --&gt;
&lt;script&gt;
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', async () =&gt; {
            try {
                const registration = await navigator.serviceWorker.register('/sw.js');
                console.log('SW registrado:', registration.scope);
            } catch (error) {
                console.log('Falha no registro do SW:', error);
            }
        });
    }
&lt;/script&gt;

&lt;!-- sw.js - Service Worker para cache inteligente --&gt;
&lt;script&gt;
// Cache strategy no Service Worker
const CACHE_NAME = 'site-v1';
const CRITICAL_ASSETS = [
    '/',
    '/styles/critical.css',
    '/js/core.js',
    '/images/hero.webp'
];

// Instalar SW e cachear recursos cr√≠ticos
self.addEventListener('install', event =&gt; {
    event.waitUntil(
        caches.open(CACHE_NAME)
            .then(cache =&gt; cache.addAll(CRITICAL_ASSETS))
    );
});

// Estrat√©gia de cache: Cache First para assets, Network First para HTML
self.addEventListener('fetch', event =&gt; {
    const { request } = event;
    
    // Estrat√©gia para diferentes tipos de recursos
    if (request.destination === 'image') {
        // Cache First para imagens
        event.respondWith(cacheFirst(request));
    } else if (request.destination === 'document') {
        // Network First para HTML
        event.respondWith(networkFirst(request));
    } else {
        // Stale While Revalidate para outros recursos
        event.respondWith(staleWhileRevalidate(request));
    }
});

async function cacheFirst(request) {
    const cached = await caches.match(request);
    return cached || fetch(request);
}

async function networkFirst(request) {
    try {
        const response = await fetch(request);
        const cache = await caches.open(CACHE_NAME);
        cache.put(request, response.clone());
        return response;
    } catch {
        return caches.match(request);
    }
}

async function staleWhileRevalidate(request) {
    const cached = await caches.match(request);
    const fetchPromise = fetch(request).then(response =&gt; {
        const cache = caches.open(CACHE_NAME);
        cache.then(c =&gt; c.put(request, response.clone()));
        return response;
    });
    
    return cached || fetchPromise;
}
&lt;/script&gt;</code></pre>
            </div>
        </section>

        <!-- Exerc√≠cio 3 -->
        <div class="exercicio">
            <h4>üèãÔ∏è‚Äç‚ôÇÔ∏è Exerc√≠cio 3: Progressive Web App</h4>
            <p>
                Transforme um site em PWA otimizada:
            </p>
            <ul>
                <li>Implemente Service Worker com cache inteligente</li>
                <li>Configure resource hints estrat√©gicos</li>
                <li>Crie sistema de CSS cr√≠tico</li>
                <li>Adicione carregamento modular de JavaScript</li>
                <li>Teste offline functionality</li>
            </ul>
        </div>

        <!-- Se√ß√£o 4: Monitoramento e Medi√ß√£o -->
        <section class="secao">
            <h2>üìà 4. Monitoramento e Medi√ß√£o</h2>
            
            <h3>üìä Performance Observer API</h3>
            <div class="codigo" data-lang="HTML">
<pre><code>&lt;script&gt;
// Monitoramento abrangente de performance
class PerformanceMonitor {
    constructor() {
        this.metrics = new Map();
        this.init();
    }
    
    init() {
        // Observar Core Web Vitals
        this.observeLCP();
        this.observeFID();
        this.observeCLS();
        
        // Observar outras m√©tricas
        this.observeNavigation();
        this.observeResources();
        
        // Enviar m√©tricas quando p√°gina estiver sendo fechada
        window.addEventListener('beforeunload', () =&gt; {
            this.sendMetrics();
        });
    }
    
    observeLCP() {
        new PerformanceObserver((entryList) =&gt; {
            const entries = entryList.getEntries();
            const lastEntry = entries[entries.length - 1];
            
            this.metrics.set('LCP', {
                value: lastEntry.startTime,
                rating: lastEntry.startTime &lt; 2500 ? 'good' : 
                       lastEntry.startTime &lt; 4000 ? 'needs-improvement' : 'poor'
            });
        }).observe({ entryTypes: ['largest-contentful-paint'] });
    }
    
    observeFID() {
        new PerformanceObserver((entryList) =&gt; {
            const entries = entryList.getEntries();
            entries.forEach(entry =&gt; {
                this.metrics.set('FID', {
                    value: entry.processingStart - entry.startTime,
                    rating: entry.processingStart - entry.startTime &lt; 100 ? 'good' : 
                           entry.processingStart - entry.startTime &lt; 300 ? 'needs-improvement' : 'poor'
                });
            });
        }).observe({ entryTypes: ['first-input'] });
    }
    
    observeCLS() {
        let clsValue = 0;
        new PerformanceObserver((entryList) =&gt; {
            const entries = entryList.getEntries();
            entries.forEach(entry =&gt; {
                if (!entry.hadRecentInput) {
                    clsValue += entry.value;
                }
            });
            
            this.metrics.set('CLS', {
                value: clsValue,
                rating: clsValue &lt; 0.1 ? 'good' : 
                       clsValue &lt; 0.25 ? 'needs-improvement' : 'poor'
            });
        }).observe({ entryTypes: ['layout-shift'] });
    }
    
    observeNavigation() {
        new PerformanceObserver((entryList) =&gt; {
            const entries = entryList.getEntries();
            entries.forEach(entry =&gt; {
                this.metrics.set('TTFB', {
                    value: entry.responseStart - entry.requestStart,
                    rating: entry.responseStart - entry.requestStart &lt; 200 ? 'good' : 
                           entry.responseStart - entry.requestStart &lt; 500 ? 'needs-improvement' : 'poor'
                });
                
                this.metrics.set('DOMContentLoaded', {
                    value: entry.domContentLoadedEventEnd - entry.domContentLoadedEventStart
                });
                
                this.metrics.set('Load', {
                    value: entry.loadEventEnd - entry.loadEventStart
                });
            });
        }).observe({ entryTypes: ['navigation'] });
    }
    
    observeResources() {
        new PerformanceObserver((entryList) =&gt; {
            const entries = entryList.getEntries();
            const resourceMetrics = {};
            
            entries.forEach(entry =&gt; {
                const type = entry.initiatorType;
                if (!resourceMetrics[type]) {
                    resourceMetrics[type] = { count: 0, totalSize: 0, totalTime: 0 };
                }
                
                resourceMetrics[type].count++;
                resourceMetrics[type].totalSize += entry.transferSize || 0;
                resourceMetrics[type].totalTime += entry.duration;
            });
            
            this.metrics.set('Resources', resourceMetrics);
        }).observe({ entryTypes: ['resource'] });
    }
    
    // M√©tricas customizadas
    measureCustomMetric(name, startTime, endTime = performance.now()) {
        this.metrics.set(name, {
            value: endTime - startTime,
            custom: true
        });
    }
    
    startMeasure(name) {
        performance.mark(`${name}-start`);
    }
    
    endMeasure(name) {
        performance.mark(`${name}-end`);
        performance.measure(name, `${name}-start`, `${name}-end`);
        
        const measure = performance.getEntriesByName(name, 'measure')[0];
        this.metrics.set(name, {
            value: measure.duration,
            custom: true
        });
    }
    
    sendMetrics() {
        const metricsData = Object.fromEntries(this.metrics);
        
        // Usar sendBeacon para envio confi√°vel
        if (navigator.sendBeacon) {
            navigator.sendBeacon('/api/metrics', JSON.stringify({
                url: window.location.href,
                userAgent: navigator.userAgent,
                metrics: metricsData,
                timestamp: Date.now()
            }));
        } else {
            // Fallback para fetch
            fetch('/api/metrics', {
                method: 'POST',
                body: JSON.stringify(metricsData),
                headers: { 'Content-Type': 'application/json' }
            }).catch(() =&gt; {
                // Salvar localmente se envio falhar
                localStorage.setItem('pendingMetrics', JSON.stringify(metricsData));
            });
        }
    }
    
    getMetrics() {
        return Object.fromEntries(this.metrics);
    }
}

// Inicializar monitor de performance
const perfMonitor = new PerformanceMonitor();

// Exemplo de uso de m√©tricas customizadas
perfMonitor.startMeasure('image-gallery-load');
// ... c√≥digo para carregar galeria ...
perfMonitor.endMeasure('image-gallery-load');

// Relat√≥rio em tempo real
console.log('üìä M√©tricas de Performance:', perfMonitor.getMetrics());
&lt;/script&gt;</code></pre>
            </div>

            <h3>üéØ Real User Monitoring (RUM)</h3>
            <div class="codigo" data-lang="HTML">
<pre><code>&lt;script&gt;
// Sistema de RUM personalizado
class RealUserMonitoring {
    constructor(config = {}) {
        this.config = {
            endpoint: '/api/rum',
            sampleRate: 0.1, // 10% dos usu√°rios
            ...config
        };
        
        this.sessionData = {
            sessionId: this.generateSessionId(),
            userId: this.getUserId(),
            startTime: Date.now(),
            pageViews: 0,
            interactions: 0,
            errors: []
        };
        
        if (Math.random() &lt; this.config.sampleRate) {
            this.init();
        }
    }
    
    init() {
        this.trackPageView();
        this.trackInteractions();
        this.trackErrors();
        this.trackPerformance();
        this.trackConnectivity();
    }
    
    trackPageView() {
        this.sessionData.pageViews++;
        
        this.send('pageview', {
            url: window.location.href,
            referrer: document.referrer,
            title: document.title,
            viewport: {
                width: window.innerWidth,
                height: window.innerHeight
            },
            device: this.getDeviceInfo()
        });
    }
    
    trackInteractions() {
        ['click', 'scroll', 'keydown'].forEach(eventType =&gt; {
            document.addEventListener(eventType, (event) =&gt; {
                this.sessionData.interactions++;
                
                if (eventType === 'click') {
                    this.send('interaction', {
                        type: 'click',
                        element: event.target.tagName,
                        classes: event.target.className,
                        text: event.target.textContent?.substring(0, 50)
                    });
                }
            }, { passive: true });
        });
    }
    
    trackErrors() {
        window.addEventListener('error', (event) =&gt; {
            this.sessionData.errors.push({
                message: event.message,
                filename: event.filename,
                line: event.lineno,
                column: event.colno,
                timestamp: Date.now()
            });
            
            this.send('error', {
                type: 'javascript',
                message: event.message,
                stack: event.error?.stack,
                url: event.filename,
                line: event.lineno
            });
        });
        
        window.addEventListener('unhandledrejection', (event) =&gt; {
            this.send('error', {
                type: 'promise-rejection',
                reason: event.reason?.toString(),
                stack: event.reason?.stack
            });
        });
    }
    
    trackPerformance() {
        // Integrar com PerformanceMonitor
        if (window.perfMonitor) {
            setInterval(() =&gt; {
                const metrics = window.perfMonitor.getMetrics();
                this.send('performance', metrics);
            }, 30000); // A cada 30 segundos
        }
    }
    
    trackConnectivity() {
        if ('connection' in navigator) {
            const connection = navigator.connection;
            
            this.send('connectivity', {
                effectiveType: connection.effectiveType,
                downlink: connection.downlink,
                rtt: connection.rtt,
                saveData: connection.saveData
            });
            
            connection.addEventListener('change', () =&gt; {
                this.send('connectivity-change', {
                    effectiveType: connection.effectiveType,
                    downlink: connection.downlink,
                    rtt: connection.rtt
                });
            });
        }
    }
    
    send(eventType, data) {
        const payload = {
            eventType,
            data,
            sessionId: this.sessionData.sessionId,
            timestamp: Date.now(),
            url: window.location.href
        };
        
        if (navigator.sendBeacon) {
            navigator.sendBeacon(this.config.endpoint, JSON.stringify(payload));
        }
    }
    
    generateSessionId() {
        return 'sess_' + Math.random().toString(36).substr(2, 16);
    }
    
    getUserId() {
        let userId = localStorage.getItem('userId');
        if (!userId) {
            userId = 'user_' + Math.random().toString(36).substr(2, 16);
            localStorage.setItem('userId', userId);
        }
        return userId;
    }
    
    getDeviceInfo() {
        return {
            userAgent: navigator.userAgent,
            language: navigator.language,
            platform: navigator.platform,
            cookieEnabled: navigator.cookieEnabled,
            onLine: navigator.onLine,
            screen: {
                width: screen.width,
                height: screen.height,
                colorDepth: screen.colorDepth
            }
        };
    }
}

// Inicializar RUM
const rum = new RealUserMonitoring({
    endpoint: '/api/rum',
    sampleRate: 0.05 // 5% dos usu√°rios
});
&lt;/script&gt;</code></pre>
            </div>

            <h3>üîß Performance Budget</h3>
            <div class="codigo" data-lang="HTML">
<pre><code>&lt;script&gt;
// Sistema de Performance Budget
class PerformanceBudget {
    constructor() {
        this.budgets = {
            // M√©tricas de timing (em ms)
            LCP: 2500,
            FID: 100,
            TTFB: 200,
            
            // M√©tricas de recursos (em KB)
            totalSize: 2000,
            imageSize: 1000,
            scriptSize: 500,
            styleSize: 200,
            
            // Contadores
            requests: 50,
            
            // CLS sem unidade
            CLS: 0.1
        };
        
        this.violations = [];
        this.init();
    }
    
    init() {
        this.checkResourceBudget();
        this.checkTimingBudget();
        this.reportViolations();
    }
    
    checkResourceBudget() {
        const observer = new PerformanceObserver((list) =&gt; {
            const entries = list.getEntries();
            let totalSize = 0;
            let imageSize = 0;
            let scriptSize = 0;
            let styleSize = 0;
            let requests = entries.length;
            
            entries.forEach(entry =&gt; {
                const size = entry.transferSize || 0;
                totalSize += size;
                
                switch (entry.initiatorType) {
                    case 'img':
                    case 'image':
                        imageSize += size;
                        break;
                    case 'script':
                        scriptSize += size;
                        break;
                    case 'link':
                    case 'css':
                        styleSize += size;
                        break;
                }
            });
            
            // Converter para KB
            const metrics = {
                totalSize: Math.round(totalSize / 1024),
                imageSize: Math.round(imageSize / 1024),
                scriptSize: Math.round(scriptSize / 1024),
                styleSize: Math.round(styleSize / 1024),
                requests
            };
            
            // Verificar viola√ß√µes
            Object.entries(metrics).forEach(([metric, value]) =&gt; {
                if (this.budgets[metric] && value &gt; this.budgets[metric]) {
                    this.addViolation(metric, value, this.budgets[metric]);
                }
            });
        });
        
        observer.observe({ entryTypes: ['resource'] });
    }
    
    checkTimingBudget() {
        // Verificar quando Core Web Vitals estiverem dispon√≠veis
        if (window.perfMonitor) {
            setTimeout(() =&gt; {
                const metrics = window.perfMonitor.getMetrics();
                
                ['LCP', 'FID', 'CLS'].forEach(metric =&gt; {
                    if (metrics[metric] && metrics[metric].value &gt; this.budgets[metric]) {
                        this.addViolation(metric, metrics[metric].value, this.budgets[metric]);
                    }
                });
            }, 5000);
        }
    }
    
    addViolation(metric, actual, budget) {
        const violation = {
            metric,
            actual,
            budget,
            excess: actual - budget,
            percentage: Math.round(((actual - budget) / budget) * 100),
            timestamp: Date.now()
        };
        
        this.violations.push(violation);
        
        // Log no console para desenvolvimento
        console.warn(
            `üö® Performance Budget Violation: ${metric}`,
            `Actual: ${actual}, Budget: ${budget}, Excess: ${violation.excess} (+${violation.percentage}%)`
        );
    }
    
    reportViolations() {
        window.addEventListener('beforeunload', () =&gt; {
            if (this.violations.length &gt; 0) {
                // Enviar viola√ß√µes para monitoramento
                navigator.sendBeacon('/api/budget-violations', JSON.stringify({
                    url: window.location.href,
                    violations: this.violations,
                    userAgent: navigator.userAgent
                }));
            }
        });
    }
    
    getReport() {
        return {
            budgets: this.budgets,
            violations: this.violations,
            status: this.violations.length === 0 ? 'PASS' : 'FAIL'
        };
    }
}

// Inicializar Performance Budget
const budgetMonitor = new PerformanceBudget();

// Mostrar relat√≥rio no console
setTimeout(() =&gt; {
    console.log('üìä Performance Budget Report:', budgetMonitor.getReport());
}, 10000);
&lt;/script&gt;</code></pre>
            </div>
        </section>

        <!-- Exerc√≠cio 4 -->
        <div class="exercicio">
            <h4>üèãÔ∏è‚Äç‚ôÇÔ∏è Exerc√≠cio 4: Sistema de Monitoramento Completo</h4>
            <p>
                Implemente um sistema completo de monitoramento:
            </p>
            <ul>
                <li>Configure Performance Observer para todas as m√©tricas</li>
                <li>Implemente Real User Monitoring (RUM)</li>
                <li>Defina e monitore Performance Budget</li>
                <li>Crie dashboard de m√©tricas em tempo real</li>
                <li>Configure alertas para viola√ß√µes de performance</li>
            </ul>
        </div>

        <!-- Resumo da Aula -->
        <section class="secao">
            <h2>üìã Resumo da Aula</h2>
            
            <div class="recursos">
                <div class="recurso-card">
                    <h4>üìä Core Web Vitals</h4>
                    <p>LCP, FID, CLS - m√©tricas essenciais de experi√™ncia do usu√°rio.</p>
                </div>
                
                <div class="recurso-card">
                    <h4>üñºÔ∏è Otimiza√ß√£o de M√≠dia</h4>
                    <p>Imagens responsivas, lazy loading e formatos modernos.</p>
                </div>
                
                <div class="recurso-card">
                    <h4>üß† Carregamento Inteligente</h4>
                    <p>Resource hints, code splitting e cache strategies.</p>
                </div>
                
                <div class="recurso-card">
                    <h4>üìà Monitoramento</h4>
                    <p>RUM, Performance Budget e m√©tricas em tempo real.</p>
                </div>
            </div>

            <div class="checklist">
                <h4>‚úÖ Checklist de Performance</h4>
                <ul>
                    <li>
                        <input type="checkbox" id="perf1">
                        <label for="perf1">Core Web Vitals dentro das metas</label>
                    </li>
                    <li>
                        <input type="checkbox" id="perf2">
                        <label for="perf2">Imagens otimizadas com lazy loading</label>
                    </li>
                    <li>
                        <input type="checkbox" id="perf3">
                        <label for="perf3">CSS cr√≠tico implementado</label>
                    </li>
                    <li>
                        <input type="checkbox" id="perf4">
                        <label for="perf4">JavaScript carregado de forma ass√≠ncrona</label>
                    </li>
                    <li>
                        <input type="checkbox" id="perf5">
                        <label for="perf5">Resource hints configurados</label>
                    </li>
                    <li>
                        <input type="checkbox" id="perf6">
                        <label for="perf6">Sistema de monitoramento ativo</label>
                    </li>
                </ul>
            </div>
        </section>

        <!-- Navega√ß√£o do Curso -->
        <nav class="course-navigation">
            <div class="nav-buttons">
                <a href="aula-10-seo-metatags.html" class="nav-btn secondary">
                    ‚Üê üìà Aula Anterior
                </a>
                <a href="aula-12-projeto-final.html" class="nav-btn primary">
                    üéØ Projeto Final ‚Üí
                </a>
            </div>
        </nav>

        <!-- Footer da Aula -->
        <footer class="aula-footer">
            <h3>üéâ Performance Dominada!</h3>
            <p>
                Incr√≠vel! Agora voc√™ sabe criar sites ultra-r√°pidos e otimizados. 
                Vamos para o projeto final e colocar tudo em pr√°tica!
            </p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Marcar como conclu√≠da
            function marcarAulaConcluida() {
                const progresso = JSON.parse(localStorage.getItem('curso-html-progresso') || '[]');
                if (!progresso.includes(11)) {
                    progresso.push(11);
                    localStorage.setItem('curso-html-progresso', JSON.stringify(progresso));
                }
            }

            // Observer para footer
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        marcarAulaConcluida();
                    }
                });
            });
            
            const footer = document.querySelector('.aula-footer');
            if (footer) {
                observer.observe(footer);
            }

            // Gerenciar checklist
            const checkboxes = document.querySelectorAll('.checklist input[type="checkbox"]');
            checkboxes.forEach((checkbox, index) => {
                const saved = localStorage.getItem(`aula-11-perf-${index}`);
                if (saved === 'true') {
                    checkbox.checked = true;
                }
                
                checkbox.addEventListener('change', () => {
                    localStorage.setItem(`aula-11-perf-${index}`, checkbox.checked);
                });
            });
        });
    </script>
</body>
</html>
